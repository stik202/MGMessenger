{"files":[{"id":"ba78d099-8c4d-4dd4-a896-0e36d4176442","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Moscow\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"182af55b-c378-4dd7-aff5-1ba75336d5da","name":"–ö–æ–¥","type":"server_js","source":"// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---\nconst DB_ID \u003d \u00271U7PuK6wSOy813HbvYAC0qrUC7TOFUBco0JJT1TPJvrI\u0027; \nconst AUTH_ID \u003d \u00271jbl4hAB5YsaRTBwYhkrIivXcF0Erf0eaAICLe7viUX4\u0027; \nconst DRIVE_FOLDER_ID \u003d \u00271SrFSO_uMjy0vxc1_i_Xjir7pJKNwYYfO\u0027; \n\nconst AUTH_COL_LOGIN \u003d 1; \nconst AUTH_COL_PASS \u003d 3; \n\nfunction doGet() {\n  return HtmlService.createTemplateFromFile(\u0027Index\u0027)\n    .evaluate()\n    .setTitle(\u0027MG Messenger\u0027)\n    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)\n    .addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width, initial-scale\u003d1\u0027);\n}\n\nfunction loginUser(login, password) {\n  const sheet \u003d SpreadsheetApp.openById(AUTH_ID).getSheets()[0];\n  const data \u003d sheet.getDataRange().getValues();\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    if (String(data[i][AUTH_COL_LOGIN]) \u003d\u003d\u003d login \u0026\u0026 String(data[i][AUTH_COL_PASS]) \u003d\u003d\u003d password) {\n      return { status: \u0027success\u0027, profile: getOrCreateProfile(login) };\n    }\n  }\n  return { status: \u0027error\u0027, message: \u0027–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å\u0027 };\n}\n\nfunction getOrCreateProfile(login) {\n  const sheet \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Profiles\u0027);\n  const data \u003d sheet.getDataRange().getValues();\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    if (String(data[i][0]) \u003d\u003d\u003d String(login)) {\n      return {\n        login: String(data[i][0]), avatar: String(data[i][1]), phone: String(data[i][2]),\n        email: String(data[i][3]), position: String(data[i][4]), role: String(data[i][5]),\n        lastName: String(data[i][6]), firstName: String(data[i][7]), middleName: String(data[i][8]),\n        name: data[i][7] ? `${data[i][7]} ${data[i][6]}` : String(data[i][0])\n      };\n    }\n  }\n  const newRow \u003d [login, \u0027\u0027, \u0027\u0027, \u0027\u0027, \u0027\u0027, \u0027User\u0027, \u0027\u0027, \u0027\u0027, \u0027\u0027];\n  sheet.appendRow(newRow);\n  return { login: login, role: \u0027User\u0027, name: login };\n}\n\n// –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è\nfunction changePassword(login, newPass) {\n  const sheet \u003d SpreadsheetApp.openById(AUTH_ID).getSheets()[0];\n  const data \u003d sheet.getDataRange().getValues();\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    if (String(data[i][AUTH_COL_LOGIN]) \u003d\u003d\u003d login) {\n      sheet.getRange(i + 1, AUTH_COL_PASS + 1).setValue(String(newPass));\n      return { status: \u0027success\u0027 };\n    }\n  }\n  return { status: \u0027error\u0027 };\n}\n\nfunction updateMyProfile(login, data) {\n  const sheet \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Profiles\u0027);\n  const values \u003d sheet.getDataRange().getValues();\n  for (let i \u003d 1; i \u003c values.length; i++) {\n    if (values[i][0] \u003d\u003d\u003d login) {\n      sheet.getRange(i + 1, 2, 1, 8).setValues([[\n        data.avatarUrl, data.phone, data.email, data.position, values[i][5], \n        data.lastName, data.firstName, data.middleName\n      ]]);\n      return { status: \u0027success\u0027 };\n    }\n  }\n}\n\nfunction uploadFileToDrive(base64Data, fileName, mimeType) {\n  const folder \u003d DriveApp.getFolderById(DRIVE_FOLDER_ID);\n  const bytes \u003d Utilities.base64Decode(base64Data.split(\u0027,\u0027)[1]);\n  const file \u003d folder.createFile(Utilities.newBlob(bytes, mimeType, fileName));\n  file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);\n  return \"https://lh3.googleusercontent.com/d/\" + file.getId();\n}\n\nfunction sendMessage(senderLogin, senderName, receiver, type, content, fileData) {\n  const sheet \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Messages\u0027);\n  let fileUrl \u003d fileData ? uploadFileToDrive(fileData.data, fileData.name, fileData.mimeType) : \u0027\u0027;\n  sheet.appendRow([Utilities.getUuid(), new Date(), senderLogin, senderName, receiver, type, content, fileData ? fileData.mimeType : \u0027\u0027, fileUrl]);\n  return { status: \u0027success\u0027 };\n}\n\nfunction getMessages(userLogin, chatPartner) {\n  const sheet \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Messages\u0027);\n  const data \u003d sheet.getDataRange().getValues();\n  return data.slice(1).filter(row \u003d\u003e \n    (row[5] \u003d\u003d\u003d \u0027private\u0027 \u0026\u0026 ((row[2] \u003d\u003d\u003d userLogin \u0026\u0026 row[4] \u003d\u003d\u003d chatPartner) || (row[2] \u003d\u003d\u003d chatPartner \u0026\u0026 row[4] \u003d\u003d\u003d userLogin))) ||\n    (row[5] \u003d\u003d\u003d \u0027group\u0027 \u0026\u0026 row[4] \u003d\u003d\u003d chatPartner)\n  ).map(row \u003d\u003e ({\n    sender: row[3], text: row[6], fileUrl: row[8], isImage: String(row[7]).includes(\u0027image\u0027),\n    isMine: row[2] \u003d\u003d\u003d userLogin, time: Utilities.formatDate(new Date(row[1]), \"GMT+3\", \"HH:mm\")\n  }));\n}\n\nfunction getActiveChats(userLogin) {\n  const msgData \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Messages\u0027).getDataRange().getValues();\n  const activeLogins \u003d new Set();\n  msgData.forEach(r \u003d\u003e {\n    if (String(r[2]) \u003d\u003d\u003d userLogin) activeLogins.add(String(r[4]));\n    if (String(r[4]) \u003d\u003d\u003d userLogin) activeLogins.add(String(r[2]));\n  });\n  \n  const profiles \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Profiles\u0027).getDataRange().getValues();\n  const users \u003d profiles.slice(1)\n    .filter(r \u003d\u003e activeLogins.has(String(r[0])))\n    .map(r \u003d\u003e ({ \n      login: String(r[0]), name: `${r[7]} ${r[6]}`, avatar: String(r[1]),\n      phone: String(r[2]), email: String(r[3]), position: String(r[4]), isGroup: false\n    }));\n    \n  const groups \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Groups\u0027).getDataRange().getValues()\n    .slice(1)\n    .filter(r \u003d\u003e String(r[3]).split(\u0027,\u0027).includes(userLogin))\n    .map(r \u003d\u003e ({ login: String(r[0]), name: String(r[1]), avatar: String(r[2]), members: String(r[3]), owner: String(r[4]), isGroup: true }));\n\n  return { users: users, groups: groups };\n}\n\nfunction getAllUsers() {\n  return SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Profiles\u0027).getDataRange().getValues()\n    .slice(1).map(r \u003d\u003e ({ \n      login: r[0], name: `${r[7]} ${r[6]}`, avatar: r[1],\n      phone: r[2], email: r[3], position: r[4],\n      searchString: `${r[7]} ${r[6]} ${r[8]} ${r[2]} ${r[3]}`.toLowerCase()\n    }));\n}\n\nfunction saveGroupSettings(groupId, data) {\n  const sheet \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Groups\u0027);\n  const rows \u003d sheet.getDataRange().getValues();\n  for(let i\u003d1; i\u003crows.length; i++) {\n    if(rows[i][0] \u003d\u003d\u003d groupId) {\n      sheet.getRange(i+1, 2, 1, 3).setValues([[data.name, data.avatar, data.members]]);\n      return {status: \u0027success\u0027};\n    }\n  }\n}\n\nfunction createGroup(name, members, owner) {\n  const sheet \u003d SpreadsheetApp.openById(DB_ID).getSheetByName(\u0027Groups\u0027);\n  // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n  if (!members.includes(owner)) {\n    members.push(owner);\n  }\n  sheet.appendRow([Utilities.getUuid(), name, \u0027\u0027, members.join(\u0027,\u0027), owner]);\n  return { status: \u0027success\u0027 };\n}"},{"id":"3d205378-210d-43b7-8cbb-2c19cfdeb1cf","name":"Index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0, maximum-scale\u003d1.0, user-scalable\u003dno\"\u003e\n  \u003cstyle\u003e\n\n    /* –°—Ç–∏–ª—å –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞-–∑–∞–≥–ª—É—à–∫–∏ */\n.avatar-placeholder {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: var(--ios-blue);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: bold;\n  font-size: 20px;\n  color: white;\n  flex-shrink: 0;\n  text-transform: uppercase;\n}\n\n/* –î–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤ –ø–æ–∏—Å–∫–µ */\n.avatar-placeholder.small {\n  width: 30px;\n  height: 30px;\n  font-size: 14px;\n}\n\n/* –î–ª—è –±–æ–ª—å—à–∏—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–µ */\n.avatar-placeholder.large {\n  width: 80px;\n  height: 80px;\n  font-size: 32px;\n}\n\n    :root { \n      --bg: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); \n      --glass: rgba(0,0,0,0.7); \n      --ios-blue: #007AFF; \n      --card-bg: #2c2c2e;\n      --input-bg: #1c1c1e;\n    }\n    \n    body { \n      margin: 0; \n      height: 100vh; \n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif; \n      background: var(--bg); \n      color: white; \n      overflow: hidden; \n    }\n    \n    .app-container { \n      width: 95%; \n      height: 94vh; \n      display: flex; \n      gap: 15px; \n      margin: 3vh auto; \n    }\n    \n    /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */\n    .sidebar { \n      width: 320px; \n      background: var(--glass); \n      backdrop-filter: blur(20px); \n      border-radius: 25px; \n      display: flex; \n      flex-direction: column; \n      border: 1px solid rgba(255,255,255,0.1); \n      z-index: 100; \n    }\n    \n    .main-chat { \n      flex: 1; \n      background: var(--glass); \n      backdrop-filter: blur(20px); \n      border-radius: 25px; \n      display: flex; \n      flex-direction: column; \n      position: relative; \n      z-index: 10; \n    }\n    \n    .avatar { \n      width: 48px; \n      height: 48px; \n      border-radius: 50%; \n      object-fit: cover; \n      background: #333; \n      flex-shrink: 0; \n    }\n    \n    .chat-item { \n      display: flex; \n      align-items: center; \n      padding: 12px; \n      cursor: pointer; \n      border-radius: 18px; \n      margin: 4px 8px; \n      transition: 0.2s; \n      background: rgba(255,255,255,0.05); \n    }\n    .chat-item:hover { background: rgba(255,255,255,0.15); }\n    \n    /* –°–æ–æ–±—â–µ–Ω–∏—è */\n    .messages { \n      flex: 1; \n      padding: 20px; \n      overflow-y: auto; \n      display: flex; \n      flex-direction: column; \n      gap: 10px; \n    }\n    .msg { \n      max-width: 75%; \n      padding: 10px 14px; \n      border-radius: 18px; \n      font-size: 15px; \n      line-height: 1.4;\n      box-shadow: 0 4px 15px rgba(0,0,0,0.2); \n    }\n    .msg.mine { align-self: flex-end; background: #e62e2e; border-bottom-right-radius: 4px; }\n    .msg.theirs { align-self: flex-start; background: #1c357e; border-bottom-left-radius: 4px; }\n    .msg img { width: 100%; border-radius: 12px; margin-top: 5px; cursor: pointer; }\n    \n    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */\n    .modal { \n      position: fixed; \n      inset: 0; \n      background: rgba(0,0,0,0.85); \n      backdrop-filter: blur(15px); \n      z-index: 2000; \n      display: none; \n      align-items: center; \n      justify-content: center; \n    }\n    .card { \n      background: var(--card-bg); \n      padding: 30px; \n      border-radius: 28px; \n      width: 340px; \n      border: 1px solid #444; \n      color: white; \n      box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n    }\n    .card input { \n      width: 100%; \n      padding: 12px; \n      margin: 8px 0; \n      border-radius: 12px; \n      border: 1px solid #555; \n      background: var(--input-bg); \n      color: white; \n      box-sizing: border-box; \n      outline: none;\n    }\n    .card button { \n      width: 100%; \n      padding: 13px; \n      margin-top: 10px; \n      border-radius: 14px; \n      border: none; \n      cursor: pointer; \n      font-weight: 600; \n      transition: 0.2s;\n    }\n    .card button:active { transform: scale(0.98); }\n\n    /* –ü–æ–∏—Å–∫ –∏ —á–∏–ø—Å—ã */\n    .chip-list { \n      display: flex; \n      flex-wrap: wrap; \n      gap: 5px; \n      margin: 10px 0; \n      background: var(--input-bg); \n      padding: 10px; \n      border-radius: 15px; \n      min-height: 40px; \n      max-height: 100px;\n      overflow-y: auto;\n    }\n    .chip { \n      background: #444; \n      padding: 5px 12px; \n      border-radius: 20px; \n      font-size: 13px; \n      display: flex; \n      align-items: center; \n    }\n    .chip span { margin-left: 8px; cursor: pointer; color: #ff4d4d; font-weight: bold; }\n\n    /* –ú–µ–Ω—é –ü–ª—é—Å */\n    .plus-menu { \n      position: absolute; \n      background: var(--card-bg); \n      border-radius: 14px; \n      padding: 8px; \n      display: none; \n      z-index: 5000; \n      border: 1px solid #444; \n      top: 60px; \n      right: 20px; \n      width: 180px; \n      box-shadow: 0 8px 24px rgba(0,0,0,0.5);\n    }\n    .plus-menu div { \n      padding: 12px; \n      cursor: pointer; \n      border-radius: 10px; \n      transition: 0.2s; \n      color: white;\n    }\n    .plus-menu div:hover { background: var(--ios-blue); }\n\n    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */\n    .loader-ring { \n      width: 24px; \n      height: 24px; \n      border: 3px solid rgba(255,255,255,0.2); \n      border-top-color: #fff; \n      border-radius: 50%; \n      animation: spin 0.8s linear infinite; \n      display: none; \n      margin-right: 10px;\n    }\n    @keyframes spin { to { transform: rotate(360deg); } }\n    \n    .input-area { padding: 15px 20px; background: rgba(0,0,0,0.2); border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; }\n    .input-wrapper { display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.15); border-radius: 24px; padding: 6px 16px; position: relative; }\n    .input-wrapper input { flex: 1; background: none; border: none; color: white; padding: 10px 0; outline: none; font-size: 15px; }\n\n    .close-txt { text-align: center; margin-top: 15px; cursor: pointer; opacity: 0.6; font-size: 14px; color: white; transition: 0.2s; }\n    .close-txt:hover { opacity: 1; }\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d MOBILE ADAPTATION (FIXED) \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n\n@media (max-width: 768px) {\n\n  body {\n    height: 100dvh;\n    overflow: hidden;\n  }\n\n  .app-container {\n    position: relative;\n    width: 100%;\n    height: 100dvh;\n    margin: 0;\n    display: block;\n  }\n\n  .sidebar,\n  .main-chat {\n    position: absolute;\n    inset: 0;\n    width: 100%;\n    height: 100%;\n    border-radius: 0;\n  }\n\n  /* ---------- SIDEBAR ---------- */\n\n  .sidebar {\n    background: var(--glass);\n    z-index: 2;\n    transform: translateX(0);\n    transition: transform .3s ease;\n  }\n\n  .sidebar.mobile-hidden {\n    transform: translateX(-100%);\n  }\n\n  /* ---------- CHAT ---------- */\n\n  .main-chat {\n    background: var(--glass);\n    z-index: 3;\n    display: flex;\n    flex-direction: column;\n    transform: translateX(100%);\n    transition: transform .3s ease;\n  }\n\n  .main-chat.mobile-active {\n    transform: translateX(0);\n  }\n\n  /* HEADER */\n  #chat-h {\n    flex-shrink: 0;\n  }\n\n  /* MESSAGES */\n  .messages {\n    flex: 1;\n    overflow-y: auto;\n    padding: 12px;\n  }\n\n  /* INPUT */\n  .input-area {\n    flex-shrink: 0;\n    border-radius: 0;\n  }\n\n  .msg {\n    max-width: 85%;\n    font-size: 14px;\n  }\n\n  .input-wrapper input {\n    font-size: 16px; /* —á—Ç–æ–±—ã iOS –Ω–µ –∑—É–º–∏–ª */\n  }\n}\n\n\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\n\u003cdiv id\u003d\"login-screen\" class\u003d\"modal\" style\u003d\"display:flex;\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003ch2 style\u003d\"text-align:center; margin-bottom: 20px;\"\u003eMG Messenger\u003c/h2\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"l-val\" placeholder\u003d\"–õ–æ–≥–∏–Ω\"\u003e\n    \u003cinput type\u003d\"password\" id\u003d\"p-val\" placeholder\u003d\"–ü–∞—Ä–æ–ª—å\"\u003e\n    \u003cbutton onclick\u003d\"login()\" style\u003d\"background:#e62e2e; color:white;\"\u003e–í–æ–π—Ç–∏\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv id\u003d\"profile-modal\" class\u003d\"modal\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003cdiv id\u003d\"profile-av-cont\" style\u003d\"display:flex; justify-content:center; margin-bottom:15px;\"\u003e\u003c/div\u003e\n    \u003cinput type\u003d\"file\" id\u003d\"av-in\" style\u003d\"display:none\" accept\u003d\"image/*\" onchange\u003d\"uploadAv(this, \u0027my\u0027)\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"ed-ln\" placeholder\u003d\"–§–∞–º–∏–ª–∏—è *\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"ed-fn\" placeholder\u003d\"–ò–º—è *\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"ed-mn\" placeholder\u003d\"–û—Ç—á–µ—Å—Ç–≤–æ\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"ed-ph\" placeholder\u003d\"–¢–µ–ª–µ—Ñ–æ–Ω *\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"ed-em\" placeholder\u003d\"Email\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"ed-pos\" placeholder\u003d\"–î–æ–ª–∂–Ω–æ—Å—Ç—å\"\u003e\n    \n    \u003cbutton onclick\u003d\"openPassModal()\" style\u003d\"background:#555; color:white; margin-bottom:10px;\"\u003e–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å\u003c/button\u003e\n    \u003cbutton onclick\u003d\"saveProfile()\" style\u003d\"background:var(--ios-blue); color:white;\"\u003e–°–æ—Ö—Ä–∞–Ω–∏—Ç—å\u003c/button\u003e\n    \u003cbutton onclick\u003d\"logout()\" style\u003d\"background:#e62e2e; color:white; margin-top:10px;\"\u003e–í—ã—Ö–æ–¥\u003c/button\u003e\n    \u003cdiv onclick\u003d\"closeModals()\" class\u003d\"close-txt\"\u003e–∑–∞–∫—Ä—ã—Ç—å\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv id\u003d\"pass-modal\" class\u003d\"modal\" style\u003d\"z-index:6000;\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003ch3\u003e–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å\u003c/h3\u003e\n    \u003cp style\u003d\"font-size:12px; opacity:0.7;\"\u003e–í–≤–µ–¥–∏—Ç–µ –æ—Ç 4 –¥–æ 6 —Ü–∏—Ñ—Ä\u003c/p\u003e\n    \u003cinput type\u003d\"number\" id\u003d\"new-pass-in\" placeholder\u003d\"1234\" oninput\u003d\"if(this.value.length \u003e 6) this.value \u003d this.value.slice(0,6)\"\u003e\n    \u003cbutton onclick\u003d\"submitNewPass()\" style\u003d\"background:var(--ios-blue); color:white;\"\u003e–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å\u003c/button\u003e\n    \u003cdiv onclick\u003d\"document.getElementById(\u0027pass-modal\u0027).style.display\u003d\u0027none\u0027\" class\u003d\"close-txt\"\u003e–æ—Ç–º–µ–Ω–∞\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv id\u003d\"search-modal\" class\u003d\"modal\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003ch3\u003e–ù–æ–≤—ã–π —á–∞—Ç\u003c/h3\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"search-in\" placeholder\u003d\"–ò–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –ø–æ—á—Ç–∞...\" oninput\u003d\"filterSearch(this.value, \u0027private\u0027)\"\u003e\n    \u003cdiv id\u003d\"search-results\" style\u003d\"max-height:200px; overflow-y:auto; margin-top:10px;\"\u003e\u003c/div\u003e\n    \u003cdiv onclick\u003d\"closeModals()\" class\u003d\"close-txt\"\u003e–∑–∞–∫—Ä—ã—Ç—å\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv id\u003d\"group-create-modal\" class\u003d\"modal\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003ch3\u003e–ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞\u003c/h3\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"gr-name-in\" placeholder\u003d\"–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"gr-search-in\" placeholder\u003d\"–ü–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...\" oninput\u003d\"filterSearch(this.value, \u0027group\u0027)\"\u003e\n    \u003cdiv id\u003d\"gr-results\" style\u003d\"max-height:120px; overflow-y:auto;\"\u003e\u003c/div\u003e\n    \u003cdiv class\u003d\"chip-list\" id\u003d\"gr-chips\"\u003e\u003c/div\u003e\n    \u003cbutton onclick\u003d\"submitGroup()\" style\u003d\"background:var(--ios-blue); color:white;\"\u003e–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É\u003c/button\u003e\n    \u003cdiv onclick\u003d\"closeModals()\" class\u003d\"close-txt\"\u003e–∑–∞–∫—Ä—ã—Ç—å\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv id\u003d\"group-settings-modal\" class\u003d\"modal\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003cimg id\u003d\"gs-av-pre\" class\u003d\"avatar\" style\u003d\"width:70px; height:70px; margin: 0 auto 10px; display:block; cursor:pointer;\" onclick\u003d\"document.getElementById(\u0027gs-av-in\u0027).click()\"\u003e\n    \u003cinput type\u003d\"file\" id\u003d\"gs-av-in\" style\u003d\"display:none\" onchange\u003d\"uploadAv(this, \u0027group\u0027)\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"gs-name-in\" placeholder\u003d\"–ù–∞–∑–≤–∞–Ω–∏–µ\"\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"gs-search-in\" placeholder\u003d\"–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞...\" oninput\u003d\"filterSearch(this.value, \u0027edit-group\u0027)\"\u003e\n    \u003cdiv id\u003d\"gs-results\" style\u003d\"max-height:100px; overflow-y:auto;\"\u003e\u003c/div\u003e\n    \u003cdiv class\u003d\"chip-list\" id\u003d\"gs-chips\"\u003e\u003c/div\u003e\n    \u003cbutton id\u003d\"gs-save-btn\" onclick\u003d\"saveGS()\" style\u003d\"background:var(--ios-blue); color:white;\"\u003e–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è\u003c/button\u003e\n    \u003cdiv onclick\u003d\"closeModals()\" class\u003d\"close-txt\"\u003e–∑–∞–∫—Ä—ã—Ç—å\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv id\u003d\"user-info-modal\" class\u003d\"modal\"\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003cimg id\u003d\"ui-av\" class\u003d\"avatar\" style\u003d\"width:100px; height:100px; margin: 0 auto 15px; display:block;\"\u003e\n    \u003ch3 id\u003d\"ui-name\" style\u003d\"text-align:center\"\u003e\u003c/h3\u003e\n    \u003cp id\u003d\"ui-pos\" style\u003d\"color:#aaa; font-size:14px; text-align:center; margin-bottom:20px;\"\u003e\u003c/p\u003e\n    \u003cdiv style\u003d\"text-align:left; font-size:14px; background:var(--input-bg); padding:15px; border-radius:15px;\"\u003e\n      \u003cdiv style\u003d\"margin-bottom:8px;\"\u003eüìû \u003cspan id\u003d\"ui-ph\"\u003e\u003c/span\u003e\u003c/div\u003e\n      \u003cdiv\u003e‚úâÔ∏è \u003cspan id\u003d\"ui-em\"\u003e\u003c/span\u003e\u003c/div\u003e\n    \u003c/div\u003e\n    \u003cbutton onclick\u003d\"closeModals()\" style\u003d\"background:var(--ios-blue); color:white; margin-top:20px;\"\u003e–ü–æ–Ω—è—Ç–Ω–æ\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class\u003d\"app-container\"\u003e\n  \u003cdiv class\u003d\"sidebar\"\u003e\n    \u003cdiv style\u003d\"padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom: 1px solid rgba(255,255,255,0.1)\"\u003e\n      \u003cdiv id\u003d\"my-av\" class\u003d\"avatar\" style\u003d\"cursor:pointer\" onclick\u003d\"openProfile()\"\u003e\u003c/div\u003e\n      \u003cdiv style\u003d\"font-weight:bold; font-size:16px; letter-spacing: 0.5px;\"\u003eMG MESSENGER\u003c/div\u003e\n      \u003cdiv style\u003d\"position:relative\"\u003e\n        \u003cbutton onclick\u003d\"togglePlus(event)\" style\u003d\"background:none; border:none; color:white; font-size:28px; cursor:pointer; line-height:1;\"\u003e+\u003c/button\u003e\n        \u003cdiv id\u003d\"plus-menu\" class\u003d\"plus-menu\"\u003e\n          \u003cdiv onclick\u003d\"openSearch()\"\u003eüë§ –ù–æ–≤—ã–π —á–∞—Ç\u003c/div\u003e\n          \u003cdiv onclick\u003d\"openGroupCreator()\"\u003eüë• –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \u003cdiv id\u003d\"chat-list\" style\u003d\"flex:1; overflow-y:auto; padding:10px 0;\"\u003e\u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\"main-chat\"\u003e\n\n  \u003cdiv id\u003d\"chat-h\"\n       style\u003d\"padding:15px 20px;\n              border-bottom:1px solid rgba(255,255,255,0.1);\n              display:flex;\n              align-items:center;\n              gap:10px;\n              min-height:40px;\"\u003e\n\n    \u003cbutton id\u003d\"back-btn\"\n            onclick\u003d\"goBack()\"\n            style\u003d\"display:none;\n                   background:none;\n                   border:none;\n                   color:white;\n                   font-size:22px;\n                   cursor:pointer;\"\u003e\n      ‚Üê\n    \u003c/button\u003e\n\n    \u003cspan id\u003d\"chat-title\"\n          style\u003d\"font-weight:600;\n                 opacity:0.9;\n                 flex:1;\"\u003e\n      –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ª–æ–≥\n    \u003c/span\u003e\n\n    \u003cbutton id\u003d\"gs-btn\"\n            style\u003d\"display:none;\n                   background:none;\n                   border:none;\n                   color:white;\n                   font-size:22px;\n                   cursor:pointer;\"\n            onclick\u003d\"openGS()\"\u003e‚ãÆ\u003c/button\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\"messages\" id\u003d\"msgs\"\u003e\u003c/div\u003e\n\n  \u003cdiv class\u003d\"input-area\"\u003e\n    \u003cdiv class\u003d\"input-wrapper\"\u003e\n      \u003cbutton id\u003d\"f-btn\"\n              onclick\u003d\"document.getElementById(\u0027f-in\u0027).click()\"\n              style\u003d\"background:none;border:none;color:white;font-size:20px;cursor:pointer;\"\u003e\n        üì∑\n      \u003c/button\u003e\n\n      \u003cdiv id\u003d\"loader\" class\u003d\"loader-ring\"\u003e\u003c/div\u003e\n\n      \u003cinput type\u003d\"file\" id\u003d\"f-in\" style\u003d\"display:none\" onchange\u003d\"handleFile(this)\"\u003e\n\n      \u003cinput type\u003d\"text\"\n             id\u003d\"m-in\"\n             placeholder\u003d\"–ù–∞–ø–∏—Å–∞—Ç—å...\"\n             onkeydown\u003d\"if(event.key\u003d\u003d\u003d\u0027Enter\u0027) send()\"\u003e\n\n      \u003cbutton id\u003d\"s-btn\"\n              onclick\u003d\"send()\"\n              style\u003d\"background:none;border:none;color:var(--ios-blue);font-size:22px;cursor:pointer;font-weight:bold;\"\u003e\n        üöÄ\n      \u003c/button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n\n\n\u003cscript\u003e\n  let user \u003d JSON.parse(localStorage.getItem(\u0027mgs_u\u0027)) || null;\n  let activeChat \u003d null;\n  let allCachedUsers \u003d [];\n  let selectedMembers \u003d [];\n  let pendingFile \u003d null;\n  let tempGsAv \u003d \u0027\u0027;\n\n  window.onload \u003d () \u003d\u003e { \n    if(user) { authOk(user); } \n    google.script.run.withSuccessHandler(res \u003d\u003e { allCachedUsers \u003d res; }).getAllUsers();\n  };\n\n  function login() {\n    const l \u003d document.getElementById(\u0027l-val\u0027).value;\n    const p \u003d document.getElementById(\u0027p-val\u0027).value;\n    google.script.run.withSuccessHandler(res \u003d\u003e {\n      if(res.status \u003d\u003d\u003d \u0027success\u0027) authOk(res.profile);\n      else alert(res.message);\n    }).loginUser(l, p);\n  }\n\n  function authOk(p) {\n  user \u003d p;\n  localStorage.setItem(\u0027mgs_u\u0027, JSON.stringify(user));\n  document.getElementById(\u0027login-screen\u0027).style.display \u003d \u0027none\u0027;\n  \n  // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏-–∞–≤–∞—Ç–∞—Ä –≤ —Å–∞–π–¥–±–∞—Ä–µ\n  document.getElementById(\u0027my-av\u0027).innerHTML \u003d getAvatarHtml(user);\n  loadChats();\n}\n\n  function loadChats() {\n  google.script.run.withSuccessHandler(res \u003d\u003e {\n    const list \u003d document.getElementById(\u0027chat-list\u0027);\n    const all \u003d [...res.groups, ...res.users];\n    list.innerHTML \u003d \u0027\u0027; \n    all.forEach(u \u003d\u003e {\n      const item \u003d document.createElement(\u0027div\u0027);\n      item.className \u003d \u0027chat-item\u0027;\n      item.onclick \u003d () \u003d\u003e startChat(u);\n      \n      let avHtml \u003d getAvatarHtml(u);\n      \n      item.innerHTML \u003d `\n        \u003cdiv onclick\u003d\"event.stopPropagation(); if(!${u.isGroup}) showUserInfo(${JSON.stringify(u).replace(/\"/g, \u0027\u0026quot;\u0027)})\"\u003e\n          ${avHtml}\n        \u003c/div\u003e\n        \u003cdiv style\u003d\"margin-left:12px; overflow:hidden;\"\u003e\n          \u003cdiv style\u003d\"font-weight:600; white-space:nowrap; text-overflow:ellipsis;\"\u003e${u.isGroup ? \u0027üë• \u0027 : \u0027\u0027}${u.name}\u003c/div\u003e\n        \u003c/div\u003e\n      `;\n      list.appendChild(item);\n    });\n  }).getActiveChats(user.login);\n}\n\n  function startChat(u) {\n  activeChat \u003d u;\n  document.getElementById(\u0027chat-title\u0027).innerText \u003d u.name;\n  \n  // –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∏–¥–Ω–∞ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –ò —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü\n  const isOwner \u003d u.isGroup \u0026\u0026 String(u.owner) \u003d\u003d\u003d String(user.login);\n  document.getElementById(\u0027gs-btn\u0027).style.display \u003d isOwner ? \u0027block\u0027 : \u0027none\u0027;\n  \n  refresh();\n}\n\n  function refresh() {\n    if(!activeChat) return;\n    google.script.run.withSuccessHandler(msgs \u003d\u003e {\n      const cont \u003d document.getElementById(\u0027msgs\u0027);\n      cont.innerHTML \u003d msgs.map(m \u003d\u003e `\n        \u003cdiv class\u003d\"msg ${m.isMine ? \u0027mine\u0027 : \u0027theirs\u0027}\"\u003e\n          \u003cdiv style\u003d\"font-size:11px; opacity:0.7; margin-bottom:3px; font-weight:600;\"\u003e${m.sender}\u003c/div\u003e\n          ${m.fileUrl ? (m.isImage ? `\u003cimg src\u003d\"${m.fileUrl}\" onclick\u003d\"window.open(\u0027${m.fileUrl}\u0027)\"\u003e` : `\u003ca href\u003d\"${m.fileUrl}\" target\u003d\"_blank\" style\u003d\"color:#fff; text-decoration:underline;\"\u003eüìé –§–∞–π–ª\u003c/a\u003e`) : \u0027\u0027}\n          \u003cdiv style\u003d\"word-break:break-word;\"\u003e${m.text}\u003c/div\u003e\n          \u003cdiv style\u003d\"font-size:10px; opacity:0.5; text-align:right; margin-top:4px;\"\u003e${m.time}\u003c/div\u003e\n        \u003c/div\u003e\n      `).join(\u0027\u0027);\n      cont.scrollTop \u003d cont.scrollHeight;\n    }).getMessages(user.login, activeChat.login);\n  }\n  setInterval(refresh, 5000);\n\n  function filterSearch(q, mode) {\n    let listId \u003d mode \u003d\u003d\u003d \u0027private\u0027 ? \u0027search-results\u0027 : (mode \u003d\u003d\u003d \u0027group\u0027 ? \u0027gr-results\u0027 : \u0027gs-results\u0027);\n    const container \u003d document.getElementById(listId);\n    container.innerHTML \u003d \u0027\u0027;\n    if (q.length \u003c 2) return;\n\n    const filtered \u003d allCachedUsers.filter(u \u003d\u003e u.searchString.includes(q.toLowerCase()) \u0026\u0026 u.login !\u003d\u003d user.login);\n    filtered.forEach(u \u003d\u003e {\n      const div \u003d document.createElement(\u0027div\u0027);\n      div.className \u003d \u0027chat-item\u0027;\n      div.style.margin \u003d \"4px 0\";\n      div.innerHTML \u003d `\u003cimg src\u003d\"${u.avatar || \u0027https://via.placeholder.com/35\u0027}\" class\u003d\"avatar\" style\u003d\"width:30px; height:30px;\"\u003e\u003cdiv style\u003d\"margin-left:10px; font-size:14px;\"\u003e${u.name}\u003c/div\u003e`;\n      div.onclick \u003d () \u003d\u003e {\n        if(mode \u003d\u003d\u003d \u0027private\u0027) { startChat(u); closeModals(); }\n        else { addChip(u, mode \u003d\u003d\u003d \u0027group\u0027 ? \u0027group\u0027 : \u0027edit-group\u0027); }\n      };\n      container.appendChild(div);\n    });\n  }\n\n  function addChip(u, mode) {\n    if(selectedMembers.some(m \u003d\u003e m.login \u003d\u003d\u003d u.login)) return;\n    selectedMembers.push(u);\n    renderChips(mode);\n  }\n\n  function renderChips(mode) {\n    const container \u003d document.getElementById(mode \u003d\u003d\u003d \u0027group\u0027 ? \u0027gr-chips\u0027 : \u0027gs-chips\u0027);\n    container.innerHTML \u003d selectedMembers.map(m \u003d\u003e `\n      \u003cdiv class\u003d\"chip\"\u003e${m.name} \u003cspan onclick\u003d\"removeChip(\u0027${m.login}\u0027, \u0027${mode}\u0027)\"\u003eüóëÔ∏è\u003c/span\u003e\u003c/div\u003e\n    `).join(\u0027\u0027);\n  }\n\n  function removeChip(login, mode) {\n    selectedMembers \u003d selectedMembers.filter(m \u003d\u003e m.login !\u003d\u003d login);\n    renderChips(mode);\n  }\n\n  function handleFile(input) {\n    const file \u003d input.files[0];\n    if(!file) return;\n    document.getElementById(\u0027f-btn\u0027).style.display \u003d \u0027none\u0027;\n    document.getElementById(\u0027loader\u0027).style.display \u003d \u0027block\u0027;\n    \n    const reader \u003d new FileReader();\n    reader.onload \u003d e \u003d\u003e {\n      pendingFile \u003d { name: file.name, mimeType: file.type, data: e.target.result };\n      document.getElementById(\u0027f-btn\u0027).style.display \u003d \u0027block\u0027;\n      document.getElementById(\u0027loader\u0027).style.display \u003d \u0027none\u0027;\n    };\n    reader.readAsDataURL(file);\n  }\n\n  function send() {\n    const txt \u003d document.getElementById(\u0027m-in\u0027).value;\n    if(!txt \u0026\u0026 !pendingFile) return;\n    google.script.run.withSuccessHandler(() \u003d\u003e {\n      document.getElementById(\u0027m-in\u0027).value \u003d \u0027\u0027;\n      pendingFile \u003d null;\n      refresh();\n    }).sendMessage(user.login, user.name, activeChat.login, activeChat.isGroup ? \u0027group\u0027 : \u0027private\u0027, txt, pendingFile);\n  }\n\n  function openProfile() {\n  document.getElementById(\u0027ed-ln\u0027).value \u003d user.lastName || \u0027\u0027;\n  document.getElementById(\u0027ed-fn\u0027).value \u003d user.firstName || \u0027\u0027;\n  document.getElementById(\u0027ed-mn\u0027).value \u003d user.middleName || \u0027\u0027;\n  document.getElementById(\u0027ed-ph\u0027).value \u003d user.phone || \u0027\u0027;\n  document.getElementById(\u0027ed-em\u0027).value \u003d user.email || \u0027\u0027;\n  document.getElementById(\u0027ed-pos\u0027).value \u003d user.position || \u0027\u0027;\n  \n  document.getElementById(\u0027profile-av-cont\u0027).innerHTML \u003d \n    `\u003cdiv onclick\u003d\"document.getElementById(\u0027av-in\u0027).click()\" style\u003d\"cursor:pointer\"\u003e\n      ${getAvatarHtml(user, \u0027large\u0027)}\n    \u003c/div\u003e`;\n    \n  document.getElementById(\u0027profile-modal\u0027).style.display \u003d \u0027flex\u0027;\n}\n\nfunction saveProfile() {\n  const data \u003d {\n    lastName: document.getElementById(\u0027ed-ln\u0027).value,\n    firstName: document.getElementById(\u0027ed-fn\u0027).value,\n    middleName: document.getElementById(\u0027ed-mn\u0027).value,\n    phone: document.getElementById(\u0027ed-ph\u0027).value,\n    email: document.getElementById(\u0027ed-em\u0027).value,\n    position: document.getElementById(\u0027ed-pos\u0027).value,\n    avatarUrl: user.avatar\n  };\n  google.script.run.withSuccessHandler(() \u003d\u003e {\n    user \u003d {...user, ...data};\n    localStorage.setItem(\u0027mgs_u\u0027, JSON.stringify(user));\n    closeModals(); loadChats();\n  }).updateMyProfile(user.login, data);\n}\n\nfunction openPassModal() {\n  document.getElementById(\u0027new-pass-in\u0027).value \u003d \u0027\u0027;\n  document.getElementById(\u0027pass-modal\u0027).style.display \u003d \u0027flex\u0027;\n}\n\nfunction submitNewPass() {\n  const pass \u003d document.getElementById(\u0027new-pass-in\u0027).value;\n  if (pass.length \u003c 4 || pass.length \u003e 6) {\n    alert(\"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 4 –¥–æ 6 —Ü–∏—Ñ—Ä\");\n    return;\n  }\n  google.script.run.withSuccessHandler(res \u003d\u003e {\n    if(res.status \u003d\u003d\u003d \u0027success\u0027) {\n      alert(\"–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω\");\n      document.getElementById(\u0027pass-modal\u0027).style.display \u003d \u0027none\u0027;\n    }\n  }).changePassword(user.login, pass);\n}\n\n  function uploadAv(input, type) {\n    const file \u003d input.files[0];\n    const reader \u003d new FileReader();\n    reader.onload \u003d e \u003d\u003e {\n      google.script.run.withSuccessHandler(url \u003d\u003e {\n        if(type \u003d\u003d\u003d \u0027my\u0027) { user.avatar \u003d url; document.getElementById(\u0027ed-av\u0027).src \u003d url; }\n        else { tempGsAv \u003d url; document.getElementById(\u0027gs-av-pre\u0027).src \u003d url; }\n      }).uploadFileToDrive(e.target.result, \"av_\"+Date.now(), file.type);\n    };\n    reader.readAsDataURL(file);\n  }\n\n  function openSearch() { \n    document.getElementById(\u0027plus-menu\u0027).style.display\u003d\u0027none\u0027; \n    document.getElementById(\u0027search-in\u0027).value \u003d \u0027\u0027;\n    document.getElementById(\u0027search-results\u0027).innerHTML \u003d \u0027\u0027;\n    document.getElementById(\u0027search-modal\u0027).style.display\u003d\u0027flex\u0027; \n  }\n\n  function openGroupCreator() {\n    selectedMembers \u003d [];\n    document.getElementById(\u0027plus-menu\u0027).style.display\u003d\u0027none\u0027;\n    document.getElementById(\u0027gr-chips\u0027).innerHTML \u003d \u0027\u0027;\n    document.getElementById(\u0027gr-name-in\u0027).value \u003d \u0027\u0027;\n    document.getElementById(\u0027gr-results\u0027).innerHTML \u003d \u0027\u0027;\n    document.getElementById(\u0027group-create-modal\u0027).style.display \u003d \u0027flex\u0027;\n  }\n\n  function submitGroup() {\n    const name \u003d document.getElementById(\u0027gr-name-in\u0027).value;\n    if(!name || !selectedMembers.length) return alert(\"–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\");\n    google.script.run.withSuccessHandler(() \u003d\u003e { closeModals(); loadChats(); })\n      .createGroup(name, selectedMembers.map(m \u003d\u003e m.login), user.login);\n  }\n\n  function openGS() {\n    const isOwner \u003d activeChat.owner \u003d\u003d\u003d user.login;\n    tempGsAv \u003d activeChat.avatar;\n    document.getElementById(\u0027gs-av-pre\u0027).src \u003d tempGsAv || \u0027https://via.placeholder.com/80\u0027;\n    document.getElementById(\u0027gs-name-in\u0027).value \u003d activeChat.name;\n    document.getElementById(\u0027gs-name-in\u0027).disabled \u003d !isOwner;\n    document.getElementById(\u0027gs-save-btn\u0027).style.display \u003d isOwner ? \u0027block\u0027 : \u0027none\u0027;\n    \n    selectedMembers \u003d allCachedUsers.filter(u \u003d\u003e activeChat.members.split(\u0027,\u0027).includes(u.login));\n    renderChips(\u0027edit-group\u0027);\n    document.getElementById(\u0027group-settings-modal\u0027).style.display \u003d \u0027flex\u0027;\n  }\n\n  function saveGS() {\n    const data \u003d {\n      name: document.getElementById(\u0027gs-name-in\u0027).value,\n      avatar: tempGsAv,\n      members: selectedMembers.map(m \u003d\u003e m.login).join(\u0027,\u0027)\n    };\n    google.script.run.withSuccessHandler(() \u003d\u003e {\n      activeChat.name \u003d data.name; activeChat.avatar \u003d data.avatar; activeChat.members \u003d data.members;\n      document.getElementById(\u0027chat-title\u0027).innerText \u003d data.name;\n      closeModals(); loadChats();\n    }).saveGroupSettings(activeChat.login, data);\n  }\n\n  function showUserInfo(u) {\n    document.getElementById(\u0027ui-av\u0027).src \u003d u.avatar || \u0027https://via.placeholder.com/100\u0027;\n    document.getElementById(\u0027ui-name\u0027).innerText \u003d u.name;\n    document.getElementById(\u0027ui-pos\u0027).innerText \u003d u.position || \u0027–°–æ—Ç—Ä—É–¥–Ω–∏–∫\u0027;\n    document.getElementById(\u0027ui-ph\u0027).innerText \u003d u.phone || \u0027–ù–µ —É–∫–∞–∑–∞–Ω\u0027;\n    document.getElementById(\u0027ui-em\u0027).innerText \u003d u.email || \u0027–ù–µ —É–∫–∞–∑–∞–Ω\u0027;\n    document.getElementById(\u0027user-info-modal\u0027).style.display \u003d \u0027flex\u0027;\n  }\n\n  function togglePlus(e) {\n    const m \u003d document.getElementById(\u0027plus-menu\u0027);\n    m.style.display \u003d (m.style.display \u003d\u003d\u003d \u0027block\u0027) ? \u0027none\u0027 : \u0027block\u0027;\n    e.stopPropagation();\n  }\n\n  function logout() {\n    localStorage.removeItem(\u0027mgs_u\u0027);\n    user \u003d null;\n    location.reload();\n  }\n\n  function closeModals() { \n    document.querySelectorAll(\u0027.modal\u0027).forEach(m \u003d\u003e { \n      if(m.id !\u003d\u003d \u0027login-screen\u0027) m.style.display\u003d\u0027none\u0027; \n    }); \n  }\n\n  window.onclick \u003d (e) \u003d\u003e { \n    if(!e.target.closest(\u0027.plus-menu\u0027)) document.getElementById(\u0027plus-menu\u0027).style.display\u003d\u0027none\u0027; \n  }\n\n  function getAvatarHtml(userObj, sizeClass \u003d \u0027\u0027) {\n  if (userObj.avatar \u0026\u0026 userObj.avatar.trim() !\u003d\u003d \u0027\u0027) {\n    return `\u003cimg src\u003d\"${userObj.avatar}\" class\u003d\"avatar ${sizeClass}\"\u003e`;\n  }\n  let char \u003d (userObj.name || userObj.login || \u0027?\u0027).charAt(0);\n  return `\u003cdiv class\u003d\"avatar-placeholder ${sizeClass}\"\u003e${char}\u003c/div\u003e`;\n  }\n\n  /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d MOBILE LOGIC \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n\nfunction isMobile() {\n  return window.innerWidth \u003c\u003d 768;\n}\n\nfunction goBack() {\n  if (!isMobile()) return;\n\n  document.querySelector(\u0027.sidebar\u0027).classList.remove(\u0027mobile-hidden\u0027);\n  document.querySelector(\u0027.main-chat\u0027).classList.remove(\u0027mobile-active\u0027);\n  document.getElementById(\u0027back-btn\u0027).style.display \u003d \u0027none\u0027;\n}\n\n/* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º startChat, –ù–ï –ª–æ–º–∞—è –≤–∞—à—É –ª–æ–≥–∏–∫—É */\n\nconst originalStartChat \u003d startChat;\n\nstartChat \u003d function(u) {\n  originalStartChat(u);\n\n  if (isMobile()) {\n    document.querySelector(\u0027.sidebar\u0027).classList.add(\u0027mobile-hidden\u0027);\n    document.querySelector(\u0027.main-chat\u0027).classList.add(\u0027mobile-active\u0027);\n    document.getElementById(\u0027back-btn\u0027).style.display \u003d \u0027block\u0027;\n  }\n};\n\n/* Swipe –Ω–∞–∑–∞–¥ */\n\nlet touchStartX \u003d 0;\n\ndocument.addEventListener(\u0027touchstart\u0027, e \u003d\u003e {\n  touchStartX \u003d e.changedTouches[0].screenX;\n});\n\ndocument.addEventListener(\u0027touchend\u0027, e \u003d\u003e {\n  if (!isMobile()) return;\n  let diff \u003d e.changedTouches[0].screenX - touchStartX;\n  if (diff \u003e 120) goBack();\n});\n\n\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e"}]}